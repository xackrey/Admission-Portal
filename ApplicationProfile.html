<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Applicant Profile - LYFJRSHS</title>
<script src="https://accounts.google.com/gsi/client" async defer></script>
<style>
/* Body and background */
body {
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  margin: 0;
  padding: 0;
  background: linear-gradient(135deg, #6a11cb, #2575fc);
  display: flex;
  justify-content: center;
  align-items: flex-start;
  min-height: 100vh;
}

/* Container card */
.container {
  background: linear-gradient(145deg, #ffffffdd, #f0f0f0dd);
  width: 95%;
  max-width: 700px;
  border-radius: 15px;
  padding: 30px;
  margin: 30px 0;
  box-shadow: 0 6px 20px rgba(0,0,0,0.3);
}

/* Header */
.header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 20px;
}
.header h2 { margin: 0; color: #2c3e50; }
.logout-btn {
  padding: 8px 15px;
  border: none;
  background-color: #e74c3c;
  color: #fff;
  font-weight: bold;
  border-radius: 6px;
  cursor: pointer;
  transition: 0.3s;
}
.logout-btn:hover { background-color: #c0392b; }

/* Google user info */
.user-info {
  display: flex;
  align-items: center;
  gap: 10px;
  margin-bottom: 25px;
  background: linear-gradient(90deg, #3498db, #9b59b6);
  padding: 10px 15px;
  border-radius: 8px;
  color: #fff;
}
.user-info img { width: 40px; border-radius: 50%; border: 2px solid #fff; }

/* Form styles */
form label {
  font-weight: bold;
  margin-top: 10px;
  display: block;
  color: #2c3e50;
}
form input, form select {
  width: 100%;
  padding: 10px;
  margin-top: 5px;
  border-radius: 6px;
  border: 1px solid #3498db;
  box-sizing: border-box;
  transition: 0.3s;
}
form input:focus, form select:focus { border-color: #9b59b6; outline: none; }

form button {
  margin-top: 20px;
  background: linear-gradient(90deg, #3498db, #9b59b6);
  color: #fff;
  font-weight: bold;
  border: none;
  cursor: pointer;
  border-radius: 8px;
  transition: 0.3s;
}
form button:hover {
  background: linear-gradient(90deg, #2980b9, #8e44ad);
}

/* Photo preview */
#photo-preview img {
  width: 120px;
  margin-top: 10px;
  border-radius: 6px;
  border: 2px solid #3498db;
}

/* Section titles */
h3 { margin-top: 20px; color: #2c3e50; border-bottom: 1px solid #ccc; padding-bottom: 5px; }
</style>
</head>
<body>

<div class="container">

  <div class="header">
    <h2>Applicant Profile</h2>
    <button class="logout-btn" id="logout">Logout</button>
  </div>

  <!-- Google User Info -->
  <div class="user-info">
    <img id="user-photo" src="logo.jpg" alt="User Photo">
    <h2>ADMISSION FORM</h2>
  </div>

  <form id="applicantForm">
    <h3>Personal Information</h3>

    <label>LRN</label>
    <input type="text" id="lrn" placeholder="12-digit LRN" pattern="[0-9]{12}" maxlength="12" required>

    <label>Given Name</label>
    <input type="text" id="givenName" placeholder="Given Name" required>

    <label>Middle Name</label>
    <input type="text" id="middleName" placeholder="Middle Name">

    <label>Surname</label>
    <input type="text" id="surname" placeholder="Surname" required>

    <label>Date of Birth</label>
    <input type="date" id="dob" required>

    <label>Place of Birth</label>
    <input type="text" id="birthPlace" placeholder="Place of Birth" required>

    <label>Sex</label>
    <select id="sex" required>
      <option value="">Select Gender</option>
      <option value="Male">Male</option>
      <option value="Female">Female</option>
    </select>

    <label>Email</label>
    <input type="email" id="email" placeholder="Email" required>

    <label>Phone Number</label>
    <input type="text" id="phone" placeholder="Phone Number" required>

    <label>Course</label>
    <select id="course" required>
      <option value="">Select Course</option>
      <option value="STEM">STEM</option>
      <option value="TVL">TVL</option>
      <option value="HUMSS">HUMSS</option>
      <option value="ABM">ABM</option>
    </select>

    <label>Track</label>
    <select id="track" required>
      <option value="">Select Track</option>
    </select>

    <label>Upload 2x2 Photo</label>
    <input type="file" id="photo-upload" accept="image/*">
    <div id="photo-preview"></div>

    <button type="submit">Submit Profile</button>
  </form>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getFirestore, collection, addDoc, query, where, getDocs } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig={
  apiKey:"AIzaSyBd0qUeuZr68Cf10bomf0mQEcjuNaE6Krs",
  authDomain:"admissionportal-ec954.firebaseapp.com",
  projectId:"admissionportal-ec954",
  storageBucket:"admissionportal-ec954.firebasestorage.app",
  messagingSenderId:"182457612989",
  appId:"1:182457612989:web:dcaa6939ea96cd5f8cd5d4"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

// Google login placeholder
document.getElementById('user-email').textContent = "user@example.com";
document.getElementById('user-photo').src = "logo.jpg";

// Logout
document.getElementById('logout').addEventListener('click', ()=>{
  alert('Logged out!');
  window.location.href = 'index.html';
});

// Photo preview
document.getElementById('photo-upload').addEventListener('change', e=>{
  const file = e.target.files[0]; const preview=document.getElementById('photo-preview'); preview.innerHTML='';
  if(file){const reader=new FileReader(); reader.onload=function(event){const img=document.createElement('img'); img.src=event.target.result; preview.appendChild(img);}
  reader.readAsDataURL(file);}
});

// Dynamic Track based on Course
const courseSelect = document.getElementById('course');
const trackSelect = document.getElementById('track');
const courseTracks = {
  'TVL': ['HE', 'CP', 'CSS', 'IA'],
  'STEM': ['Science', 'Math', 'Engineering'],
  'HUMSS': ['Social Science', 'Humanities'],
  'ABM': ['Accounting', 'Business', 'Management']
};

courseSelect.addEventListener('change', () => {
  const selectedCourse = courseSelect.value;
  trackSelect.innerHTML = '<option value="">Select Track</option>';
  if(courseTracks[selectedCourse]){
    courseTracks[selectedCourse].forEach(track => {
      const option = document.createElement('option');
      option.value = track;
      option.textContent = track;
      trackSelect.appendChild(option);
    });
  }
});

// Submit form with single registration per LRN
document.getElementById('applicantForm').addEventListener('submit', async e=>{
  e.preventDefault();
  const lrnValue = document.getElementById('lrn').value.trim();

  if(!lrnValue){
    alert("Please enter your LRN.");
    return;
  }

  // Check if LRN exists
  const q = query(collection(db,'applications'), where('lrn','==',lrnValue));
  const querySnapshot = await getDocs(q);

  if(!querySnapshot.empty){
    alert("This LRN is already registered!");
    return;
  }

  // Submit data
  const data = {
    lrn: lrnValue,
    givenName: document.getElementById('givenName').value,
    middleName: document.getElementById('middleName').value,
    surname: document.getElementById('surname').value,
    dob: document.getElementById('dob').value,
    birthPlace: document.getElementById('birthPlace').value,
    sex: document.getElementById('sex').value,
    email: document.getElementById('email').value,
    phone: document.getElementById('phone').value,
    course: document.getElementById('course').value,
    track: document.getElementById('track').value,
    photo: document.getElementById('photo-preview').querySelector('img')?.src || ''
  };

  try{
    await addDoc(collection(db,'applications'), data);
    alert('Profile submitted successfully!');
    e.target.reset();
    document.getElementById('photo-preview').innerHTML='';
  }catch(err){
    alert('Error saving: '+err.message);
  }
});
</script>
</body>
</html>
