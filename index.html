<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>LYFJRSHS Admission Portal</title>

<!-- Firebase SDKs -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
  import { getFirestore, doc, setDoc, getDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
  import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, GoogleAuthProvider, signInWithPopup } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

  // Firebase config
  const firebaseConfig = {
    apiKey: "AIzaSyBd0qUeuZr68Cf10bomf0mQEcjuNaE6Krs",
    authDomain: "admissionportal-ec954.firebaseapp.com",
    projectId: "admissionportal-ec954",
    storageBucket: "admissionportal-ec954.appspot.com",
    messagingSenderId: "182457612989",
    appId: "1:182457612989:web:dcaa6939ea96cd5f8cd5d4"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);
  const auth = getAuth(app);
  const googleProvider = new GoogleAuthProvider();

  window.loginOrSignup = async function() {
    const email = document.getElementById("email").value.trim();
    const password = document.getElementById("password").value.trim();
    const isLogin = window.isLogin;

    if(!email || !password) return alert("Please fill in all fields");

    try {
      let userCredential;
      if(isLogin) {
        userCredential = await signInWithEmailAndPassword(auth, email, password);
      } else {
        userCredential = await createUserWithEmailAndPassword(auth, email, password);

        // Save empty student profile in Firestore
        await setDoc(doc(db, "applications", userCredential.user.uid), {
          email: email,
          strand: "",
          specialization: "",
          lrn: "",
          sex: "",
          phone: "",
          address: "",
          exam: { date: "", time: "" }
        });
      }

      alert("Success! Redirecting...");
      window.location.href = `applicationprofile.html?uid=${userCredential.user.uid}`;

    } catch(error) {
      alert(error.message);
    }
  }

  window.googleLogin = async function() {
    try {
      const result = await signInWithPopup(auth, googleProvider);
      const user = result.user;

      // Check if user doc exists, create if not
      const docRef = doc(db, "applications", user.uid);
      const docSnap = await getDoc(docRef);
      if(!docSnap.exists()) {
        await setDoc(docRef, {
          email: user.email,
          strand: "",
          specialization: "",
          lrn: "",
          sex: "",
          phone: "",
          address: "",
          exam: { date: "", time: "" }
        });
      }

      window.location.href = `applicationprofile.html?uid=${user.uid}`;
    } catch(error) {
      alert(error.message);
    }
  }

</script>

<style>
body {
  margin: 0;
  font-family: Arial, sans-serif;
  height: 100vh;
  display: flex;
  justify-content: center;
  align-items: center;
  background: url('image.jpg') no-repeat center center fixed;
  background-size: cover;
}
.container {
  background: rgba(255, 255, 255, 0.95);
  padding: 40px 30px;
  width: 360px;
  border-radius: 20px;
  box-shadow: 0 15px 40px rgba(0, 0, 0, 0.3);
  text-align: center;
  backdrop-filter: blur(5px);
  position: relative;
}
.logo img { width: 100px; border-radius: 50%; margin-bottom: 20px; }
h2 { margin-bottom: 20px; }
input { width: 90%; padding: 12px; margin: 10px 0; border-radius: 8px; border: 1px solid #ccc; }
button { width: 95%; padding: 12px; margin-top: 15px; border: none; border-radius: 10px; background: #f44336; color: white; font-weight: bold; cursor: pointer; }
button:hover { background: #d32f2f; }
.switch { margin-top: 12px; font-size: 14px; cursor: pointer; color: #4CAF50; }
.switch:hover { text-decoration: underline; }
</style>
</head>
<body>

<div class="container">
  <div class="logo">
    <img src="logo.jpg" alt="LYFJRSHS Logo">
    <h2>LYFJRSHS Admission Portal</h2>
  </div>

  <h2 id="formTitle">LOGIN</h2>

  <input type="email" id="email" placeholder="Email" required>
  <input type="password" id="password" placeholder="Password" required>
  <button onclick="loginOrSignup()">Login</button>

  <div class="switch" onclick="toggleForm()">Don't have an account? Sign Up</div>

  <hr>

  <button onclick="googleLogin()" style="background:#4285F4;">Sign in with Google</button>
</div>

<script>
window.isLogin = true;

function toggleForm() {
  window.isLogin = !window.isLogin;
  document.getElementById("formTitle").innerText = window.isLogin ? "Login" : "Sign Up";
  document.querySelector("button").innerText = window.isLogin ? "Login" : "Sign Up";
  document.querySelector(".switch").innerText = window.isLogin ? "Don't have an account? Sign Up" : "Already have an account? Login";
}
</script>

</body>
</html>

