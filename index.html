<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>LYFJRSHS Admission Portal</title>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js"></script>
<script src="https://accounts.google.com/gsi/client" async defer></script>

<style>
body {
  margin:0; font-family:Arial,sans-serif;
  height:100vh; display:flex; justify-content:center; align-items:center;
  background:url('image.jpg') no-repeat center center fixed;
  background-size:cover;
}
.container{
  background:rgba(255,255,255,0.95); padding:40px 30px; width:360px;
  border-radius:20px; box-shadow:0 15px 40px rgba(0,0,0,0.3);
  text-align:center; backdrop-filter:blur(5px);
}
button{width:95%; padding:12px; margin-top:15px; border:none;
  border-radius:10px; background:#f44336; color:white; cursor:pointer; font-weight:bold;
}
button:hover{background:#d32f2f;}
#codeSection{display:none;}
</style>
</head>
<body>

<div class="container">
  <h2>Login with Google</h2>
  <div id="g_id_onload"
       data-client_id="113380731276-thphd4f39c218f40b6e47lk09ndomd35.apps.googleusercontent.com"
       data-login_uri=""
       data-auto_prompt="false"
       data-callback="handleCredentialResponse">
  </div>
  <div class="g_id_signin" data-type="standard"></div>

  <!-- Confirmation code -->
  <div id="codeSection">
    <h3>Enter Confirmation Code</h3>
    <input type="text" id="confirmCode" placeholder="6-digit code">
    <p id="timer"></p>
    <button id="verifyBtn">Verify Code</button>
    <button id="resendBtn" disabled>Resend Code</button>
  </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getAuth, signInWithCredential, GoogleAuthProvider } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

const firebaseConfig = {
  apiKey: "AIzaSyBd0qUeuZr68Cf10bomf0mQEcjuNaE6Krs",
  authDomain: "admissionportal-ec954.firebaseapp.com",
  projectId: "admissionportal-ec954",
  storageBucket: "admissionportal-ec954.appspot.com",
  messagingSenderId: "182457612989",
  appId: "1:182457612989:web:dcaa6939ea96cd5f8cd5d4"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);

let generatedCode = "";
let countdown;
let countdownTime = 120; // 2 minutes
let resendTimeout = 60; // 1 min

function startCountdown() {
  const timerEl = document.getElementById("timer");
  let timeLeft = countdownTime;
  timerEl.textContent = `Time left: ${timeLeft}s`;

  countdown = setInterval(() => {
    timeLeft--;
    timerEl.textContent = `Time left: ${timeLeft}s`;
    if (timeLeft <= 0) {
      clearInterval(countdown);
      alert("Code expired! Resend to get a new code.");
      document.getElementById("resendBtn").disabled = false;
    }
  }, 1000);
}

function sendCode() {
  generatedCode = Math.floor(100000 + Math.random()*900000).toString();
  alert("Your confirmation code is: " + generatedCode);
  document.getElementById("codeSection").style.display = "block";
  startCountdown();

  document.getElementById("resendBtn").disabled = true;
  setTimeout(()=> document.getElementById("resendBtn").disabled = false, resendTimeout*1000);
}

window.handleCredentialResponse = async function(response){
  // Get Google credential
  const credential = GoogleAuthProvider.credential(response.credential);
  try{
    await signInWithCredential(auth, credential);
    // Auto sign-up/login success
    sendCode();
  }catch(e){
    console.error(e);
    alert("Login failed!");
  }
}

document.getElementById("verifyBtn").addEventListener("click", ()=>{
  const userCode = document.getElementById("confirmCode").value.trim();
  if(userCode === generatedCode){
    clearInterval(countdown);
    alert("Verified! Redirecting...");
    window.location.href = "applicationprofile.html";
  }else{
    alert("Incorrect code!");
  }
});

document.getElementById("resendBtn").addEventListener("click", ()=>{
  sendCode();
});

</script>
</body>
</html>
